<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>NYC Accident Data</title>
    <script src="https://d3js.org/d3.v4.min.js">  </script>
  </head>
  <body bgcolor="black">

    <h1 align="center" style="color: white"> New York Police Department Motor Vehicle Collisions </h1>
    <h4 align="center" style="color: white"> A Borough-Wise Distribution of Accidents from 2012-2018 </h4>
    <h2 style="color: white">Select Another Year</h2>
    <select id="year-dropdown">
      <option value="2018">2018</option>
      <option value="2017">2017</option>
      <option value="2016">2016</option>
      <option value="2015">2015</option>
      <option value="2014">2014</option>
      <option value="2013">2013</option>
      <option value="2012">2012</option>
    </select>
    <p style="color: white" id="selected-dropdown">Quick Observation: The data contains information till 03/09/2018, and we can observe that the number of accidents in the three months is almost same across four of the boroughs, namely: Manhattan, Brooklyn, Queens and Bronx.</p>

    <script type="text/javascript">

      //Width and height
      var w = 1200;
      var h = 600;
      var margin = {top: 50, right: 50, bottom: 50, left: 50};
      var innerHeight = h - margin.top - margin.bottom;
      var innerWidth = w - margin.left - margin.right;

      var dataset = [{borough: "Manhattan", count2018: 5291, count2017: 31487, count2016: 36766, count2015: 42517, count2014: 41262, count2013: 41578, count2012: 20719},
                     {borough: "Brooklyn", count2018: 7887, count2017: 44631, count2016: 47698, count2015: 50843, count2014: 47758, count2013: 47016, count2012: 23302},
                     {borough: "Queens", count2018: 7098, count2017: 38377, count2016: 41556, count2015: 42484, count2014: 41019, count2013: 39310, count2012: 20719},
                     {borough: "Bronx", count2018: 3926, count2017: 21187, count2016: 21704, count2015: 21251, count2014: 19687, count2013: 19768, count2012: 19139},
                     {borough: "Staten Island", count2018: 1034, count2017: 6212, count2016: 6720, count2015: 6344, count2014: 6614, count2013: 8295, count2012: 4902}];

       var max2018 = d3.max(dataset, function(d) {return d.count2018;})
       var max2017 = d3.max(dataset, function(d) {return d.count2017;})
       var max2016 = d3.max(dataset, function(d) {return d.count2016;})
       var max2015 = d3.max(dataset, function(d) {return d.count2015;})
       var max2014 = d3.max(dataset, function(d) {return d.count2014;})
       var max2013 = d3.max(dataset, function(d) {return d.count2013;})
       var max2012 = d3.max(dataset, function(d) {return d.count2012;})
       var all_max = [max2018, max2017, max2016, max2015, max2014, max2013, max2012]

       fin_max = d3.max(all_max)

        var svg = d3.select("body")
          .append("svg")
            .attr("width", w)
            .attr("height", h);

        svg.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", w)
            .attr("height", h)
            .attr("fill", "lightgreen");

        var xScale = d3.scaleBand()
            .domain(dataset.map(function(d) {return d.borough;}))
            .range([0, innerWidth]);

        var yScale = d3.scaleLinear()
            .domain([0, fin_max])
            .range([innerHeight, 0]);

        var xAxis = d3.axisBottom()
            .scale(xScale);

        var yAxis = d3.axisLeft()
             .scale(yScale);

        var bars = svg.append("g")
            .attr("id", "plot")
            .attr("transform", `translate (${margin.left}, ${margin.top})`)
            .selectAll("rect")
            .data(dataset);


        bars.enter().append("rect")
            .attr("x", (d, i) => xScale(d.borough)+85)
            .attr("y", d => yScale(d.count2018))
            .attr("width", "50")
            .attr("height", d => innerHeight - yScale(d.count2018))
            .attr("fill", "black")
            .on('mouseover', mouseOver)
            .on('mouseout', mouseOut)

        svg.append("g")
            .attr("class", "xAxis")
            .attr("transform", `translate (${margin.left}, ${h - margin.top})`)
            .call(xAxis);

        svg.append("g")
            .attr("class", "yAxis")
            .attr("transform", `translate (${margin.left}, ${margin.top})`)
            .call(yAxis);

        currYear = 2018

        function mouseOver(d, i) {
          if (currYear == 2018) {
              d3.selectAll("g").selectAll("rect")
              .append("text")
              .attr("id", "value")
              .attr("x", (d, i) => xScale(d.borough)+85)
              .attr("y", function(d) {return yScale(d.count2018) + 10;})
              .text(function(d) {return d.count2018;});
              console.log(d.count2018, xScale(d.borough)+85, yScale(d.count2018) + 10)
            }
          if (currYear == 2017) {
              d3.selectAll("g").selectAll("rect")
              .append("text")
              .attr("id", "value")
              .attr("x", (d, i) => xScale(d.borough)+85)
              .attr("y", function(d) {return yScale(d.count2017) + 10;})
              .text(function(d) {return d.count2017;});
              console.log(d.count2017, xScale(d.borough)+85, yScale(d.count2017) + 10)
            }
          if (currYear == 2016) {
              d3.selectAll("g").selectAll("rect")
              .append("text")
              .attr("id", "value")
              .attr("x", (d, i) => xScale(d.borough)+85)
              .attr("y", function(d) {return yScale(d.count2016) + 10;})
              .text(function(d) {return d.count2016;});
              console.log(d.count2016, xScale(d.borough)+85, yScale(d.count2016) + 10)
            }
        if (currYear == 2015) {
              d3.selectAll("g").selectAll("rect")
              .append("text")
              .attr("id", "value")
              .attr("x", (d, i) => xScale(d.borough)+85)
              .attr("y", function(d) {return yScale(d.count2015) + 10;})
              .text(function(d) {return d.count2015;});
              console.log(d.count2015, xScale(d.borough)+85, yScale(d.count2015) + 10)
          }
        if (currYear == 2014) {
              d3.selectAll("g").selectAll("rect")
              .append("text")
              .attr("id", "value")
              .attr("x", (d, i) => xScale(d.borough)+85)
              .attr("y", function(d) {return yScale(d.count2014) + 10;})
              .text(function(d) {return d.count2014;});
              console.log(d.count2014, xScale(d.borough)+85, yScale(d.count2014) + 10)
          }
        if (currYear == 2013) {
              d3.selectAll("g").selectAll("rect")
              .append("text")
              .attr("id", "value")
              .attr("x", (d, i) => xScale(d.borough)+85)
              .attr("y", function(d) {return yScale(d.count2013) + 10;})
              .text(function(d) {return d.count2013;});
              console.log(d.count2013, xScale(d.borough)+85, yScale(d.count2013) + 10)
          }
        if (currYear == 2012) {
          d3.selectAll("g").selectAll("rect")
          .append("text")
          .attr("id", "value")
          .attr("x", (d, i) => xScale(d.borough)+85)
          .attr("y", function(d) {return yScale(d.count2012) + 10;})
          .text(function(d) {return d.count2012;});
          console.log(d.count2012, xScale(d.borough)+85, yScale(d.count2012) + 10)
          }
        }
        function mouseOut(d, i) {
              d3.selectAll("#value").remove();
          }

      </script>

      <script>

      d3.select("select")
        .on("change",function(d) {
          currYear = d3.select("#year-dropdown").node().value;

          if (currYear == "2018")
          {
          d3.selectAll("g").selectAll("rect")
              .transition()
              .duration(2000)
              .attr("y", d => yScale(d.count2018))
              .attr("height", d => innerHeight - yScale(d.count2018))
              d3.select("#selected-dropdown").text("Quick Observation: The data contains information till 03/09/2018, and we can observe that the number of accidents in the three months is almost same across four of the boroughs, namely: Manhattan, Brooklyn, Queens and Bronx.");
          }


          if (currYear == "2017")
          {
          d3.selectAll("g").selectAll("rect")
              .transition()
              .duration(2000)
              .attr("y", d => yScale(d.count2017))
              .attr("height", d => innerHeight - yScale(d.count2017))
              d3.select("#selected-dropdown").text("Quick Observation: The number of accidents in 2017 have dropped as compared to 2016.");
          }

          if (currYear == "2016")
          {
          d3.selectAll("g").selectAll("rect")
              .transition()
              .duration(2000)
              .attr("y", d => yScale(d.count2016))
              .attr("height", d => innerHeight - yScale(d.count2016))
              d3.select("#selected-dropdown").text("Quick Observation: The number of accidents have dropped in 2016 as compared to 2015.");
          }

          if (currYear == "2015")
          {
          d3.selectAll("g").selectAll("rect")
              .transition()
              .duration(2000)
              .attr("y", d => yScale(d.count2015))
              .attr("height", d => innerHeight - yScale(d.count2015))
              d3.select("#selected-dropdown").text("Quick Observation: 2015 observed the maximum number of accidents in almost all of the boroughs, expecially Brooklyn.");
          }

          if (currYear == "2014")
          {
          d3.selectAll("g").selectAll("rect")
              .transition()
              .duration(2000)
              .attr("y", d => yScale(d.count2014))
              .attr("height", d => innerHeight - yScale(d.count2014))
              d3.select("#selected-dropdown").text("Quick Observation: There was a small increase in the number of accidents in 2014 as compared to 2013.");
          }

          if (currYear == "2013")
          {
          d3.selectAll("g").selectAll("rect")
              .transition()
              .duration(2000)
              .attr("y", d => yScale(d.count2013))
              .attr("height", d => innerHeight - yScale(d.count2013))
              d3.select("#selected-dropdown").text("Quick Observation: Brooklyn experiences that maximum number of accidents among all boroughs, and Manhattan and Queens have almost the same number of accidents.");
          }

          if (currYear == "2012")
          {
          d3.selectAll("g").selectAll("rect")
              .transition()
              .duration(2000)
              .attr("y", d => yScale(d.count2012))
              .attr("height", d => innerHeight - yScale(d.count2012))
              d3.select("#selected-dropdown").text("Quick Observation: The year 2012 covers information from the month of July till the month of December.");
          }
      })

      </script>
      <br>
      <br>
      <br>
      <h3 style="color: white"> Some key observations from the data: </h3>
      <ul style="color: white">
        <li> Bronx has observed almost the same number of accidents every year while the others have fluctuated quite a lot. </li> <br>
        <li> 2015 was the year where the maximum number of accidents took place in most boroughs.</li> <br>
        <li> Brooklyn sees the maximum number of accidents each year. </li> <br>
        <li> The number of accidents across four of the boroughs (Manhattan, Brooklyn, Queens and Bronx) is nearly the same in 2012 (covering July - December) and 2018 (covering January - March). </li>
      </ul>
      <br>
      <br>
      <br>
      <p align="center" style="color: white"> Created by Aakanksha Joshi, Adarsh Chavakula, Harsheel Soin and Deepak Maran for the course STATGR5702: Exploratory Data Analysis and Visualization at Columbia University in the City of New York (Spring 2018) </p>

  </body>
</html>
